#!/bin/sh
#█▓▒░ vars
#full=▓
#empty=░
full=━
#empty=━
#empty=─
#full=┅
empty=┄

name=$USER
host=$(cat /proc/sys/kernel/hostname)
distro=$(lsb_release -sd)
distro=${distro##[\"\']}  # Remove qoutes around distribution name
distro=${distro%%[\"\']}  # Remove qoutes around distribution name
kernel=$(uname -r)
kernel=${kernel%%-*}
pkgs=$(pacman -Qqs | wc -l)
font=$(fc-match monospace | awk '{printf $2$3$4}')
shell=$(basename "$SHELL")
uptime=$(uptime -p | sed 's/up //')
term=$TERMINAL

xdef=$(grep -o 'Gruvbox' ~/.config/xorg/colors/xcolor)
colors="$xdef"

## UI DETECTION
if [ -n "${DE}" ]; then
  ui="${DE}"
  uitype='DE'
elif [ -n "${WM}" ]; then
  ui="${WM}"
  uitype='WM'
elif [ -n "${XDG_CURRENT_DESKTOP}" ]; then
  ui="${XDG_CURRENT_DESKTOP}"
  uitype='DE'
elif [ -n "${DESKTOP_SESSION}" ]; then
  ui="${DESKTOP_SESSION}"
  uitype='DE'
elif [ -f "${HOME}/.xinitrc" ]; then
  ui="$(tail -n 1 "${HOME}/.xinitrc" | cut -d ' ' -f 2)"
  uitype='WM'
elif [ -f "${HOME}/.xsession" ]; then
  ui="$(tail -n 1 "${HOME}/.xsession" | cut -d ' ' -f 2)"
  uitype='WM'
else
  ui='unknown'
  uitype='UI'
fi

#█▓▒░ progress bar
draw() {
    perc=$1
    size=$2
    inc=$((perc * size / 100))
    color="${3-34}"
    v=0
    while [ "$v" -le 10 ]; do
        if [ $v -le $inc ]; then
            out="${out}\033[1;${color}m${full}"
        else
            out="${out}\033[0;${color}m${empty}"
        fi
        v=$((v + 1))
    done
    printf "%b\n" "$out"
}

#█▓▒░ greets
printf " \033[0m  hello \033[34m$name\033[0m, i'm \033[34m$host\n\n\033[0m"

#█▓▒░ environment
printf " \033[1;33m      distro \033[0m$distro\n"
printf " \033[1;33m      kernel \033[0m$kernel\n"
printf " \033[1;33m    packages \033[0m$pkgs\n"
printf " \033[1;33m          wm \033[0m$ui\n"
printf " \033[1;33m        font \033[0m$font\n"
printf " \033[1;33m       shell \033[0m$shell\n"
printf " \033[1;33m       term  \033[0m$term\n"
printf " \033[1;33m      uptime \033[0m$uptime\n"
printf " \033[1;33m      colors \033[0m$colors\n"
printf " \033[0m\n"

#█▓▒░ cpu
cpu=$(grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}')
c_lvl=$(printf "%.0f" "$cpu")
printf "   \033[0;34m%-4s \033[1;34m%-5s %-25s \n" " cpu" "$c_lvl%" "$(draw "$c_lvl" 10)"

#█▓▒░ ram
ram=$(free | awk '/Mem:/ {print int($3/$2 * 100.0)}')
printf "   \033[0;34m%-4s \033[1;34m%-5s %-25s \n" " ram" "$ram%" "$(draw "$ram" 10)"

#█▓▒░ temperature
temp=$(sensors | awk '/Core 0/ {gsub(/\+/,"",$3); gsub(/\..+/,"",$3)    ; print $3}')
[ "$temp" -ge 70 ] && color='31' || color='34'

printf "   \033[0;${color}m%-4s \033[1;${color}m%-5s %-25s \n\n" "temp" "$temp°C " "$(draw "$temp" 15 "$color")"
